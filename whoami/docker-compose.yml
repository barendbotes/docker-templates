version: '3.9'

services:
  whoami:
    image: traefik/whoami
    networks:
      - proxy
    labels:
      - traefik.enable=true
      - traefik.docker.network=proxy
      - traefik.http.routers.${SERVICE}.entrypoints=https
      - traefik.http.routers.${SERVICE}.rule=Host(`${URL}`)
      - traefik.http.services.${SERVICE}-service.loadbalancer.server.port=${PORT}
      - traefik.http.services.${SERVICE}-service.loadbalancer.server.scheme=http
      - traefik.http.services.${SERVICE}-service.loadbalancer.sticky.cookie=true
      - traefik.http.services.${SERVICE}-service.loadbalancer.sticky.cookie.httponly=true
      - traefik.http.services.${SERVICE}-service.loadbalancer.sticky.cookie.secure=true
      - traefik.http.services.${SERVICE}-service.loadbalancer.sticky.cookie.samesite=strict
      - traefik.http.services.${SERVICE}-service.loadbalancer.sticky.cookie.name=${COOKIE}
      - traefik.http.routers.${SERVICE}.tls=true
      - traefik.http.routers.${SERVICE}.middlewares=public-chain@file
networks:
  proxy:
    external: true
